<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Project Ratings - Charijoy</title>
  <link rel="stylesheet" href="css/style.css">
  <style>
    .rating-container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f8f9fa;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .project-card {
      padding: 20px;
      margin-bottom: 20px;
      border: 1px solid #ddd;
      border-radius: 8px;
      background-color: white;
    }
    .project-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    .avg-rating {
      font-size: 24px;
      font-weight: bold;
      color: #ff9800;
    }
    .stars {
      display: inline-block;
    }
    .star {
      font-size: 24px;
      color: #ddd;
      cursor: pointer;
    }
    .star.filled {
      color: #ff9800;
    }
    .comment-list {
      margin-top: 20px;
      max-height: 300px;
      overflow-y: auto;
    }
    .comment-card {
      padding: 10px;
      margin-bottom: 10px;
      border: 1px solid #eee;
      border-radius: 4px;
    }
    .comment-header {
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      color: #666;
      margin-bottom: 5px;
    }
    .comment-actions {
      display: flex;
      gap: 10px;
    }
    .comment-actions button {
      background: none;
      border: none;
      color: #0d6efd;
      cursor: pointer;
      font-size: 14px;
    }
    .add-rating {
      margin-top: 20px;
      padding: 15px;
      border-top: 1px solid #eee;
    }
    .form-group {
      margin-bottom: 15px;
    }
    .form-control {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    .btn-submit {
      background-color: #0d6efd;
      color: white;
      padding: 8px 15px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="portfolio">
    <header class="header">
      <h1>Project Ratings</h1>
      <a href="index.html"><button class="button button1">Home</button></a>
      <a href="ratings.html"><button class="button button2">Ratings</button></a>
      <a href="endorsements.html"><button class="button button3">Endorsements</button></a>
      <a href="resources.html"><button class="button button4">Resources</button></a>
    </header>
    
    <div class="rating-container">
      <h2>Rate My Projects</h2>
      <p>Please share your feedback on my portfolio projects!</p>
      
      <div id="projects-list">
        <!-- Projects will be loaded here -->
      </div>
    </div>
    
    <footer class="footer">
      <p>&copy; 2025 Charijoy Cempron</p>
    </footer>
  </div>
  
  <script>
    // Sample project data
    const projects = [
      { id: 'proj1', name: 'Personal Website', description: 'My portfolio website showcasing skills and projects' },
      { id: 'proj2', name: 'Interactive Quiz', description: 'A dynamic quiz application with custom quiz creation' },
      { id: 'proj3', name: 'Resource Library', description: 'Collection of useful learning materials and links' }
    ];
    
    // Get ratings from localStorage
    let ratings = JSON.parse(localStorage.getItem('projectRatings')) || {};
    
    // Initialize ratings for each project if not exists
    projects.forEach(project => {
      if (!ratings[project.id]) {
        ratings[project.id] = [];
      }
    });
    
    // Generate user ID (simple implementation, in real app would use auth)
    let userId = localStorage.getItem('userId');
    if (!userId) {
      userId = 'user_' + Math.random().toString(36).substr(2, 9);
      localStorage.setItem('userId', userId);
    }
    
    // Calculate average rating
    function getAverageRating(projectId) {
      const projectRatings = ratings[projectId];
      if (!projectRatings || projectRatings.length === 0) return 0;
      
      const sum = projectRatings.reduce((total, rating) => total + rating.stars, 0);
      return (sum / projectRatings.length).toFixed(1);
    }
    
    // Render projects
    function renderProjects() {
      const projectsList = document.getElementById('projects-list');
      projectsList.innerHTML = '';
      
      projects.forEach(project => {
        const avgRating = getAverageRating(project.id);
        const userRating = ratings[project.id].find(r => r.userId === userId);
        
        const projectCard = document.createElement('div');
        projectCard.className = 'project-card';
        projectCard.innerHTML = `
          <div class="project-header">
            <div>
              <h3>${project.name}</h3>
              <p>${project.description}</p>
            </div>
            <div class="avg-rating">${avgRating} ★</div>
          </div>
          
          <div class="stars" data-project="${project.id}">
            ${Array(5).fill().map((_, i) => `
              <span class="star ${userRating && userRating.stars > i ? 'filled' : ''}" data-value="${i+1}">★</span>
            `).join('')}
          </div>
          
          <div class="add-rating">
            <h4>${userRating ? 'Edit Your Comment' : 'Add Your Comment'}</h4>
            <div class="form-group">
              <textarea class="form-control" id="comment-${project.id}" placeholder="Share your thoughts...">${userRating ? userRating.comment : ''}</textarea>
            </div>
            <button class="btn-submit" onclick="saveRating('${project.id}')">
              ${userRating ? 'Update Rating' : 'Submit Rating'}
            </button>
            ${userRating ? `<button class="btn-delete" onclick="deleteRating('${project.id}')">Delete Rating</button>` : ''}
          </div>
          
          <div class="comment-list">
            <h4>Comments (${ratings[project.id].length})</h4>
            ${ratings[project.id].map(rating => `
              <div class="comment-card">
                <div class="comment-header">
                  <div>User ${rating.userId.substr(5, 4)} - ${rating.stars} ★</div>
                  <div class="comment-date">${new Date(rating.date).toLocaleDateString()}</div>
                </div>
                <div>${rating.comment}</div>
                ${rating.userId === userId ? `
                  <div class="comment-actions">
                    <button onclick="editRating('${project.id}')">Edit</button>
                    <button onclick="deleteRating('${project.id}')">Delete</button>
                  </div>
                ` : ''}
              </div>
            `).join('')}
          </div>
        `;
        
        projectsList.appendChild(projectCard);
      });
      
      // Add star rating event listeners
      document.querySelectorAll('.star').forEach(star => {
        star.addEventListener('click', function() {
          const projectId = this.parentNode.dataset.project;
          const value = parseInt(this.dataset.value);
          
          // Update visual stars
          document.querySelectorAll(`.stars[data-project="${projectId}"] .star`).forEach((s, i) => {
            s.classList.toggle('filled', i < value);
          });
          
          // Find existing rating
          const existingRating = ratings[projectId].find(r => r.userId === userId);
          
          // Update existing or create new rating
          if (existingRating) {
            existingRating.stars = value;
          } else {
            ratings[projectId].push({
              userId: userId,
              stars: value,
              comment: '',
              date: new Date().toISOString()
            });
          }
          
          // Save to localStorage
          localStorage.setItem('projectRatings', JSON.stringify(ratings));
        });
      });
    }
    
    // Save rating and comment
    function saveRating(projectId) {
      const commentText = document.getElementById(`comment-${projectId}`).value;
      const existingRating = ratings[projectId].find(r => r.userId === userId);
      
      if (existingRating) {
        // Update existing
        existingRating.comment = commentText;
        existingRating.date = new Date().toISOString();
      } else {
        // Create new with default 5 stars if no stars selected
        const stars = document.querySelectorAll(`.stars[data-project="${projectId}"] .star.filled`).length || 5;
        ratings[projectId].push({
          userId: userId,
          stars: stars,
          comment: commentText,
          date: new Date().toISOString()
        });
      }
      
      // Save to localStorage
      localStorage.setItem('projectRatings', JSON.stringify(ratings));
      
      // Refresh display
      renderProjects();
    }
    
    // Delete rating
    function deleteRating(projectId) {
      if (confirm('Are you sure you want to delete your rating?')) {
        ratings[projectId] = ratings[projectId].filter(r => r.userId !== userId);
        localStorage.setItem('projectRatings', JSON.stringify(ratings));
        renderProjects();
      }
    }
    
    // Edit rating - scroll to rating form
    function editRating(projectId) {
      const ratingForm = document.querySelector(`.project-card .add-rating textarea#comment-${projectId}`);
      if (ratingForm) {
        ratingForm.scrollIntoView({ behavior: 'smooth' });
        ratingForm.focus();
      }
    }
    
    // Initial render
    renderProjects();
  </script>
</body>
</html>